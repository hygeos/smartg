#####################
# SMART-G CHANGELOG #
#####################




v1.3.2
======

- improvement of the visualization tool, renamed tools/analyze/smartg_analyze.py


v1.3.1
======

- removed direct signal at 0+ (was leading to a problem of performance)
- [BUGFIX] lambertian surface: photons must be depolarized
- rename THS -> THV in parameters and source code
- [BUGFIX] error in countPhotons


v1.3
====

-- New features --

- added the propagation of photons in the ocean (ocean-atmosphere coupling)
        * Added the following simulation types (SIM parameter)
                # 0: ocean and dioptre
                # 2: atmosphere, dioptre and ocean
                # 3: ocean only
        * Scattering in the ocean is always in parallel mode, even if the
          propagation in the atmosphere is in spherical mode. In this case, we
          consider that the photon leaves the ocean at the same point where it
          entered.
        * The propagation in the ocean is activated by the compilation flag
          FLAGOCEAN (on by default). This flag has not been removed because it
          leads to a small performance diminution (~15%) in the cases without
          propagation in the ocean.
        * Added the following parameters in the parameters file:
           -> total water absorption coefficient ATOT
           -> total water scattering coefficient BTOT
           -> PATHDIFFOCE: the file containing the total phase function for
              scattering in the ocean. This file contains the following columns:
              scattering angle in degrees, I+Q, I-Q, U, V. This file has LSAOCE
              lines (LSAOCE is specified in the parameter file)
        * added a python script tools/water_model.py allowing to calculate the
          water properties (phase function, absorption and scattering
          coefficients) for a given wavelength and chlorophyll concentration

- Added as an output, the downward radiance field at the bottom of the atmosphere (BOA)
  (this result corresponds to resultDown.txt in the SOS code)
  -> added as an optional output, the radiance fields at BOA: I_down (0+), Q_down (0+), U_down (0+)

  Rem: when the downward BOA radiance is calculated, the calculation is most of
  the time significantly slowed down, because all the photons which did not
  interact with the atmosphere before reaching the BOA (this is the sun glint)
  are counted in the same box. Since the counting is made atomically, this
  leads to a significant slowdown. This slowdown could be avoided by not
  counting these photons, and by adding their contribution a posteriori,
  because it can be calculated analytically.

- added the possibility to account for the sun glint combined with a lambertian
  surface (for comparison with the OS).
  This type of surface is activated by using the variable DIOPTRE = 4 in the
  parameter file. In this case, SUR must be equal to 3. As a normal lambertian
  surface, its albedo is adjusted through the parameter W0LAM.
    
- added monochromatic absorption (example: ozone)
  * takes into account the vertical profile of the absorbents optical thickness
  * only when using a user profile (PROFIL = 2)
  * Added a column (absorption coefficient) in the vertical profile, which can
    be zero in order to deactivate the absorption
  

-- Bugfixes --

- fixed a bug in the function surfaceAgitee in spherical mode.
  A test (photon at coordinates (x,y) = (0,0)) was performed incorrectly, which
  could lead in some cases to nan values and degrade the results. This was in
  particular true for the sun glint, which by definition hits the ground at
  coordinates (0,0). Moreover, the variable isp was not correctly initialized,
  which was leading to errors.

- variable HATM (atmosphere optical thickness): this variable was sometimes
  harcoded


-- Improvements --

- modification in the output format (the file type is still hdf4)
    Attributes modifications:
        * the calculation mode is now SSA/PPA instead of SP/PP
        * the solar zenith angle is now "VZA (deg.)" instead of "THSDEG"
    Modifications in the output datasets
        * "Valeurs de la reflectance (I)" -> "I_up (TOA)"
        * "Valeurs de Q" -> "Q_up (TOA)"
        * "Valeurs de U" -> "U_up (TOA)"
        * "Valeurs de la lumiere polarisee (LP)" -> "LP_up (TOA)"
        * "Valeurs de theta echantillonnees" -> "Zenith angles"
        * "Valeurs de phi echantillonnees" -> "Azimut angles"

- modification of the format the the aerosol phase function. It is now provided as:
        P1 = I+Q
        P2 = I-Q
        P3 = U
        instead of:
        P1 = (I+Q)/2
        P2 = (I-Q)/2
        P3 = U
  The tool "phase.f" and the example files have been modified accordingly.

- removed the forced scattering option, which was useless in the vast majority
  of the use cases.

- internal reorganization of the code, in order to allow for simulations
  including the ocean, and BOA outputs

- removed useless compilation flags: TRAJET, TEMPS and TABRAND
